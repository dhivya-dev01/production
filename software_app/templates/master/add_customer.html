{% include 'includes/header.html' %}
{% include 'includes/sidenavbar.html' %}
{% include 'includes/navbar.html' %}
{% load static %}


<style>
    form input {
    text-transform: uppercase;
} 


</style>  


<div class="pcoded-main-container">
    <div class="pcoded-wrapper">
        <div class="pcoded-content">
            <div class="pcoded-inner-content">
                <div class="main-body">
                    <div class="page-wrapper">

                        <div class="row">
                            <div class="col-sm-12">
                                <div class="card">
                                    <div class="card-header">
                                        <div class="d-flex align-items-center">
                                            <div class="page-header-title">
                                                <h4 class="m-b-10 me-1">Party</h4>
                                            </div>
                                            <!-- <button type="button" class="btn btn-gradient-primary btn-sm" data-bs-toggle="modal" data-bs-target="#add_modal">Add</button> -->
                                            <!-- <button type="button" class="btn btn-gradient-success btn-sm" onclick="refresh_data()">Refresh</button> -->
                                        </div>
                                        <ul class="breadcrumb">
                                            <li class="breadcrumb-item"><a href="/admin"><i class="feather icon-home"></i></a></li>
                                            <li class="breadcrumb-item">Masters</li>
                                            <li class="breadcrumb-item"><a href="/party">Party</a></li>
                                        </ul>
                                        <!-- <h5>Unit Of Measurement</h5> -->
                                        <div class="card-header-right">
                                            <div class="btn-group card-option">
                                                <button type="button" class="btn dropdown-toggle btn-icon" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                    <i class="feather icon-more-horizontal"></i>
                                                </button>
                                                <ul class="list-unstyled card-option dropdown-menu dropdown-menu-end">
                                                    <li class="dropdown-item full-card"><a href="#!"><span><i
                                                                    class="feather icon-maximize"></i>
                                                                maximize</span><span style="display:none"><i
                                                                    class="feather icon-minimize"></i>
                                                                Restore</span></a></li>
                                                    <li class="dropdown-item minimize-card"><a href="#!"><span><i
                                                                    class="feather icon-minus"></i> collapse</span><span
                                                                style="display:none"><i class="feather icon-plus"></i>
                                                                expand</span></a></li>
                                                    <li class="dropdown-item reload-card"><a href="#!"><i
                                                                class="feather icon-refresh-cw"></i> reload</a></li>
                                                    <li class="dropdown-item close-card"><a href="#!"><i
                                                                class="feather icon-trash"></i> remove</a></li>
                                                </ul>
                                            </div>
                                        </div>

                                    </div>
                                    <div class="card">
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-xl-12">
                                                    <form id="add_new" method="POST">
                                                        <!-- <section class="hk-sec-wrapper"> -->



                                                            {% csrf_token %}
                                                            <div class="row ">
                                                                <div class="col-md-6">
                                                                    <h5>Party  Details</h5>
                                                                    <div class="">
                                                                        <div class="row mt-2"> 
                                                                            <div class="col-md-3 mb-2">
                                                                                <label for="name" class="form-label">Prefix</label>
                                                                                <input class="form-control" id="prefix" name="prefix" type="text" placeholder=""   maxlength="15">
                                                                            </div>

                                                                            <div class="col-md-6 mb-2">
                                                                                <label for="name" class="form-label"><span style="color: red;">*</span> Company Name</label>
                                                                                <input class="form-control" id="name" name="name" type="text" placeholder="" required >
                                                                            </div>
                                                                            
                                                                            <div class="col-md-3 mb-2">
                                                                                <label for="name" class="form-label"> Nick Name</label>
                                                                                <input class="form-control" id="nick_name" name="nick_name" type="text" placeholder="">
                                                                            </div>
                                                                      

                                                                        </div>
                                                                        <div class="row">
 
                                                                            <div class="col-md-3 mb-2">
                                                                                <label for="name" class="form-label">Mobile Number</label>

                                                                                <input class="form-control " type="text" id="mobile_number" name="mobile"  >&nbsp;&nbsp;
                                                                                <!-- <div class="col-md-4">
                            
                                                                                    <span  id="mobile-error" style="color: red;   display: none;"></span>
                            
                                                                                </div>                                                 -->
                                                                            </div> 

                                                                            <div class="col-md-3 mb-2">
                                                                                <label for="email" class="form-label"> Email</label>
                                                                                <input class="form-control" id="email" name="email" type="email" placeholder=""   style="text-transform: lowercase;">
                                                                            </div>

                                                                            <div class="col-md-3 mb-2">
                                                                                <label for="email" class="form-label">Phone</label>
                                                                                <input class="form-control" id="phone" name="phone" type="text" placeholder="" >
                                                                            </div>
                                                                            <div class="col-md-3 mb-2">
                                                                                <label for="state_code" class="form-label">State Code</label>
                                                                                <input class="form-control" id="state_code" name="state_code" type="text" placeholder="" >
                                                                            </div>

                                                                        </div>
                                                                        <div class="row">
                                                                            <div class="col-md-6 mb-2">
                                                                                <label for="mobile" class="form-label"> Address</label>
                                                                                <textarea class="form-control" id="address" name="address" type="text" rows="2" placeholder="" ></textarea>
                                                                            </div>

                                                                            <div class="col-md-3 mb-2">
                                                                                <label for="mobile" class="form-label">City</label>
                                                                                <input class="form-control" id="city" name="city" type="text" value="Tirupur" placeholder="" >
                                                                            </div>

                                                                            <div class="col-md-3 mb-2">
                                                                                <label for="mobile" class="form-label">State</label>
                                                                                <input class="form-control" id="state" name="state" type="text" value="Tamil Nadu" placeholder="" >
                                                                            </div>
                                                                            <div class="col-md-3 mb-2">
                                                                                <label for="mobile" class="form-label">Pincode</label>
                                                                                <input class="form-control" id="pincode" name="pincode" value="0" type="number" placeholder="" >
                                                                            </div>
                                                                            <div class="col-md-3 mb-2">
                                                                                <label for="gstin" class="form-label">GSTIN</label>
                                                                                <input class="form-control" id="gstin" name="gstin" type="text" placeholder="" >
                                                                            </div>
																			
																			
																			
											
                                                                            <div class="col-md-3 mb-2">
                                                                                <label for="latitude" class="form-label">Latitude</label>
                                                                                <input class="form-control" id="latitude" name="latitude" type="text" placeholder="" >
                                                                            </div> 

                                                                            <div class="col-md-3 mb-2">
                                                                                <label for="longitude" class="form-label">Longitude</label>
                                                                                <input class="form-control" id="longitude" name="longitude" type="text" placeholder="" >
                                                                            </div>
                                                                            <div class="col-md-3 mb-1">
																				<label for="state_code" class="form-label">Udyam No.</label>
																				<input type="text" class="form-control" id="udyam_no" name="udyam_no">
																			</div>

                                                                            <div class="col-md-3 mb-1">
                                                                                <label for="price_list" class="form-label">Price List</label>
                                                                                <select id="price_list" name="price_list" class="form-control single-select" required>
                                                                                    <option>Select</option>
                                                                                    {% for p in price_list %}
                                                                                    <option value="{{p.id}}">{{p.name}}</option>
                                                                                    {% endfor %}
                                                                                </select>
                                                                            </div>  

                                                                            <div class="col-md-6 mb-2">
                                                                                <label for="remarks" class="form-label">Remarks</label>
                                                                                <textarea class="form-control" id="description" name="description" rows="2" type="text" placeholder=""></textarea>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
 

                                                                <div class="col-md-2">
                                                                    <h5>Party Type</h5>
                                                                    <section class="mt-2">
                                                                        <div class="">
                                                                            <!-- style="margin-left: 10px;" -->
                                                                            
                                                                            <div class="row mb-3 mt-4">
                                                                                <div class="col-md-6 mt-3 mb-2">
                                                                                    <input class="form-check-input" type="checkbox" id="is_vendor" name="is_vendor" value=1>
                                                                                    <label class="form-label" for="is_vendor">Mill</label>
                                                                                </div>
                                                                                <div class="col-md-6 mt-2 mb-2">
                                                                                    <input class="form-check-input" type="checkbox" id="is_trader" name="is_trader" value=1>
                                                                                    <label class="form-label" for="is_trader">Trader</label>
                                                                                </div>
    
    
                                                                                <div class="col-md-6  mt-2 mb-2">
                                                                                    <input class="form-check-input" type="checkbox" id="is_knitting" name="is_knitting" value=1>
                                                                                    <label class="form-label" for="is_knitting">Knitting</label>
                                                                                </div>

                                                                            <!-- </div> 
                                                                            
                                                                            <div class="row mb-3 mt-2"> -->

                                                                                <div class="col-md-6  mt-2 mb-2">
                                                                                    <input class="form-check-input" type="checkbox" id="is_b_d" name="is_b_d" value=1>
                                                                                    <label class="form-label" for="is_bleaching">Process(B/D)</label>
                                                                                </div>
                                                                                <!-- <div class="col-md-6  mt-2 mb-2">
                                                                                    <input class="form-check-input" type="checkbox" id="is_bleaching" name="is_bleaching" value=1>
                                                                                    <label class="form-label" for="is_bleaching">Bleaching</label>
                                                                                </div>
                                                                                <div class="col-md-6  mt-2 mb-2">
                                                                                    <input class="form-check-input" type="checkbox" id="is_dyeing" name="is_dyeing" value=1>
                                                                                    <label class="form-label" for="is_dyeing">Dyeing</label>
                                                                                </div> -->
                                                                            <!-- </div>
                                                                            
                                                                            <div class="row mb-3 mt-2"> -->
                                                                                <div class="col-md-6  mt-2 mb-2">
                                                                                    <input class="form-check-input" type="checkbox" id="is_compacting" name="is_compacting" value=1>
                                                                                    <label class="form-label" for="is_compacting">Compacting</label>
                                                                                </div>
<!-- 
                                                                                <div class="col-md-6 mt-3 mb-2">
                                                                                    <input class="form-check-input" type="checkbox" id="is_supplier" name="is_supplier" value=1>
                                                                                    <label class="form- label" for="is_supplier">Supplier</label>
                                                                                </div>
                                                                            

                                                                               
                                                                                <div class="col-md-6">
                                                                                    <label class="form-label">Supply Items</label>
                                                                                    <select class="form-control select2" id="supply_id" name="supply_id">
                                                                                        {% for k in supply %}
                                                                                        <option value="{{k.id}}">{{k.name}}</option> 
                                                                                        {% endfor %}
                                                                                    </select>
                                                                                </div> -->

                                                                                <div class="col-md-6 mt-3 mb-2">
                                                                                    <input class="form-check-input" type="checkbox" id="is_supplier" name="is_supplier" value="1">
                                                                                    <label class="form-label" for="is_supplier">Supplier</label>
                                                                                </div>
                                                                                
                                                                                <!-- Supply Items dropdown (Initially hidden) -->
                                                                               
                                                                                

                                                                            <!-- </div>
                                                                            
                                                                            <div class="row mb-3 mt-2"> -->
                                                                                 <div class="col-md-6  mt-2 mb-2">
                                                                                    <input class="form-check-input" type="checkbox" id="is_cutting" name="is_cutting" value=1>
                                                                                    <label class="form-label" for="is_cutting">Cutting</label>
                                                                                </div>
                                                                                <div class="col-md-6  mt-2 mb-2">
                                                                                    <input class="form-check-input" type="checkbox"id="is_stiching" name="is_stiching" value=1>
                                                                                    <label class="form-label" for="is_stiching">Stiching</label>
                                                                                </div>
    
                                                                            
    
                                                                                <div class="col-md-6  mt-2 mb-2" >
                                                                                    <input class="form-check-input" type="checkbox"  id="is_ironing" name="is_ironing" value=1>
                                                                                    <label class="form-label" for="is_ironing"> Ironing & Pack</label>
                                                                                </div>

                                                                                <div class="col-md-6  mt-2 mb-2" >
                                                                                    <input class="form-check-input" type="checkbox"  id="is_fabric" name="is_fabric" value=1>
                                                                                    <label class="form-label" for="is_fabric"> Fabric</label>
                                                                                </div>


                                                                            <!-- </div> --> 

                                                                            <div class="col-md-12" id="supply_items_div" style="display: none;">
                                                                                <label class="form-label">Supply Items</label>
                                                                                <select class="form-control select2" id="supply_id" name="supply_id" multiple>
                                                                                    {% for k in supply %}
                                                                                    <option value="{{ k.id }}">{{ k.name }}</option> 
                                                                                    {% endfor %}
                                                                                </select>
                                                                            </div>


                                                                        </div>
                                                                    </section>

                                                                </div>


                                                                <div class="col-md-4">
                                                                    <h5>Contact Person Details</h5>
                                                                    <section >
                                                                        <div class=""> 
                                                                            <div class="row">
                                                                                <div class="col-md-6 mt-2 ">
                                                                                    <label for="ph_name" class="form-label"> Name</label>
                                                                                    <input class="form-control" id="ph_name" name="ph_name" type="text" placeholder="Name">
                                                                                </div>
                                                                                <div class="col-md-6 mt-2">
                                                                                    <label for="ph_email" class="form-label">Email</label>
                                                                                    <input class="form-control" id="ph_email" name="ph_email" type="text" placeholder="Email">
                                                                                </div>
                                                                                

 
                                                                                <div class="col-md-6 mt-2">
                                                                                    <label for="ph_phone" class="form-label">Mobile</label>
                                                                                    <input class="form-control" id="ph_phone" name="ph_phone" type="number" placeholder="Mobile">
                                                                                </div>
                                                                                
                                                                                
                                                                                <div class="col-md-6 mt-2">
                                                                                    <label for="ph_email" class="form-label">Designation</label>
                                                                                    <input class="form-control" id="designation" name="designation" type="text" placeholder="Designation">
                                                                                </div>

                                                                                <!-- <div class="col-md-6 mt-2">
                                                                                    <label for="dob" class="form-label">DOB</label>
                                                                                    <input class="form-control" id="dob" name="dob" type="date" placeholder="Date of Birth">
                                                                                </div> -->
                                                                            </div> 
                                                                            <div class="col-md-12 mb-3 mt-2">
                                                                                <button type="button" class="btn btn-raised btn-primary mt-3" onclick="addrow()">+</button>
                                                                            </div>
                                                                            <!-- </div> --> 
                                                                            <div class="row mt-4">
                                                                                <div class="col-sm">
                                                                                    <!-- <div class="table-wrap">
                                                                                    <table id="contact_table" class="table table-responsive table-hover w-100 display pb-30"> -->

                                                                                    <div class="dt-responsive table-responsive table-hover">
                                                                                        <table id="contact_table" class="table table-striped table-bordered nowrap w-100">

                                                                                            <thead>
                                                                                                <tr>
                                                                                                    <th>#</th> 
                                                                                                    <th>Name</th>
                                                                                                    <th>Email</th>
                                                                                                    <th>Mobile</th>
                                                                                                    <th>Designation</th> 
                                                                                                </tr>
                                                                                            </thead>
                                                                                            <tbody>
                                                                                                <tr>
                                                                                                    <td colspan="5" class="text-center">No data</td>
                                                                                                </tr>
                                                                                            </tbody>
                                                                                        </table>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                    </section>
                                                                </div> 
                                                               
                                                                <div class="mt-2  " style="text-align: center; margin-left: 10px;">
                                                                    <input type="hidden" id="csrf_token" value="{{csrf_token}}">
                                                                    <button type="button" class="btn btn-secondary" onclick="history.back()">Close</button>
                                                                    <button type="submit" id="submit" class="btn btn-primary">Save</button>
                                                                </div> 
                                                            </div>
                                                            <br>
                                                      
                                                      
                                                        
                                                    <!-- </section> -->
                                                </form>
                                                </div>
                                            </div>

                                        </div>
                                            <!-- /Container -->


                                    </div>
                                </div>
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% include 'includes/footer.html' %}

<script type="text/javascript">
    $('.select2').select2();
</script>


<script type="text/javascript">



    var first = true;
 
    function remove_row(mrow) {
        $(mrow).closest('tr').remove();
    }



$(document).ready(function () {
    // Check state on page load
    if ($("#is_supplier").prop("checked")) {
        $("#supply_items_div").show();
    } else {
        $("#supply_items_div").hide();   
    } 


    // Toggle display on checkbox change
    $("#is_supplier").change(function () {
        if ($(this).prop("checked")) {
            $("#supply_items_div").fadeIn(); // Show with animation
        } else {
            $("#supply_items_div").fadeOut(); // Hide with animation
        }
    });
});



function storeTblValues() {
    var TableData = [];
    $('#contact_table tr').each(function (row, tr) {
        var name = $(tr).find('td:eq(1)').text().trim();
        var email = $(tr).find('td:eq(2)').text().trim();
        var phone = $(tr).find('td:eq(3)').text().trim();
        var designation = $(tr).find('td:eq(4)').text().trim();

        // Only add the contact if it has at least one valid value
        if (name || email || phone) {
            TableData.push({
                "name": name,
                "email": email,
                "phone": phone,
                'designation':designation,
            });
        }
    });

    return TableData;
}




$("#add_new").submit(function (e) {
    if (!confirm('Are you sure you want to add the party?')) {
        return false;
    }

    e.preventDefault();

    var formData = new FormData(this); // Serialize form data

    // Collect contact details from the table
    var contactDetails = storeTblValues();
    formData.append('contacts', JSON.stringify(contactDetails)); // Send as JSON

    $.ajax({
        type: 'POST',
        url: '/party_detail_add/',
        data: formData,
        processData: false,
        contentType: false,  
        success: function (response) {
            if (response.status === 'Success') {
                notifier.show(
                    'Well Done!', 
                    'Party added successfully.', 
                    'success', 
                    "{% static 'assets/images/notification/ok-48.png' %}",  
                    4000
                ); 

                $('#add_new').trigger('reset'); 
                $('#contact_table tbody').empty();
            } else {
                notifier.show(
                    'Error!', 
                    response.message || 'Failed to add party.',  
                    'danger', 
                    "{% static 'assets/images/notification/high_priority-48.png' %}", 
                    4000
                );               
            }
        },
        error: function(xhr, status, error) {
            sweetalert('error', 'Failed to add party. An error occurred.');
        }
    });
});





    function addrow() {
        if (first) {
            first = false;
            $("#contact_table > tbody").html("");
        } 

        var ph_name = $('#ph_name').val(); 
        var ph_email = $('#ph_email').val();
        var ph_phone = $('#ph_phone').val();
        var designation = $('#designation').val();

        if (ph_name != '') {
            $('#contact_table').prepend(
                "<tr>" +
                "<td><a onclick='remove_row(this)' class='mb-xs mt-xs mr-xs btn btn-xs btn-outline-danger btn-amu' href='javascript:void(0)'><i class='feather icon-trash-2'></i></a></td>" +
                "<td contenteditable='true'>" + ph_name + "</td>" +
                "<td contenteditable='true'>" + ph_email + "</td>" +
                "<td contenteditable='true'>" + ph_phone + "</td>" +
                "<td contenteditable='true'>" + designation + "</td>" +
                "</tr>"
            );
            $('#ph_name').val('');
            $('#ph_email').val('');
            $('#ph_phone').val('');
            $('#designation').val('');
        } else {
            alert('Invalid input');
        }
    }
</script>


