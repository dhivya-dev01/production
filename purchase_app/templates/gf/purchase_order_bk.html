
{% include 'includes/header.html' %}
{% include 'includes/sidenavbar.html' %}
{% include 'includes/navbar.html' %}
{% load static %}

<div class="pcoded-main-container">
    <div class="pcoded-wrapper">
        <div class="pcoded-content">
            <div class="pcoded-inner-content"> 
                <div class="main-body">
                    <div class="page-wrapper">
                        <div class="row">
                            <div class="col-sm-12">
                                <div class="card">
                                    <div class="card-header">
                                         <div class="page-header-title">
                                            <h4 class="m-b-10">GF Purchase Order  </h4>
                                        </div>
                                        <ul class="breadcrumb">
                                            <li class="breadcrumb-item"><a href="/dashboard"><i
                                                        class="feather icon-home"></i></a></li>
                                            <li class="breadcrumb-item">Grey Fabric</a></li>
                                            <li class="breadcrumb-item"><a href="/po-list">GF Purchase Order </a></li>
                                        </ul>
                                        <div class="card-header-right">
                                            <div class="btn-group card-option">
                                                <button type="button" class="btn dropdown-toggle btn-icon"
                                                    data-bs-toggle="dropdown" aria-haspopup="true"
                                                    aria-expanded="false">
                                                    <i class="feather icon-more-horizontal"></i>
                                                </button>
                                                <ul class="list-unstyled card-option dropdown-menu dropdown-menu-end">
                                                    <li class="dropdown-item full-card"><a href="#!"><span><i
                                                                    class="feather icon-maximize"></i>
                                                                maximize</span><span style="display:none"><i
                                                                    class="feather icon-minimize"></i>
                                                                Restore</span></a></li>
                                                    <li class="dropdown-item minimize-card"><a href="#!"><span><i
                                                                    class="feather icon-minus"></i> collapse</span><span
                                                                style="display:none"><i class="feather icon-plus"></i>
                                                                expand</span></a></li>
                                                    <li class="dropdown-item reload-card"><a href="#!"><i
                                                                class="feather icon-refresh-cw"></i> reload</a></li>
                                                    <li class="dropdown-item close-card"><a href="#!"><i
                                                                class="feather icon-trash"></i> remove</a></li>
                                                </ul>
                                            </div>
                                        </div>
                                      
                                        
                                    </div>


                                
                                 
                                    
                                    <div class="row">
                                        <div class="col-sm-12">
                                           
                                            <div class="card">
                                                <div class="row">
                                                    <div class="col-md-8">
                    
                                                        <form id="add_new" method="POST">
                                                            {% csrf_token %}
                                                            <div class="row ms-2">
                                                                 <div class="col-md-3 mt-3">
                                                                     <label for="order_date" class="form-label">Purchase Date</label>
                                                                     <input class="form-control" type="date" name="purchase_date" id="purchase_date" required>
                                                                 </div>

                                                                 <div class="col-md-3 mt-3">
                                                                    <label for="product_id" class="form-label">Supplier </label>
                                                                    <select id="supplier_id" name="supplier_id" class="form-control form-select single-select" onchange="LoadDo()" required>
                                                                        <option value="">Select</option>
                                                                        {% for k in supplier %}
                                                                        <option value="{{ k.id }}">{{ k.name }}</option> 
                                                                        {% endfor %}
                                                                    </select>
                                                                </div>

                                                                <div class="col-md-3 mt-3">
                                                                    <label for="product_id" class="form-label">DO List </label>
                                                                    <select id="do_id" name="do_id" class="form-control form-select single-select" required>
                                                                        <option value="">Select</option>
                                                                       
                                                                    </select>
                                                                </div>
                    
                                                                <div class="col-md-3 mt-3">
                                                                    <div class="">
                                                                        <label for="product_id" class="form-label">Product</label>
                                                                        <select id="product_id" name="product_id" class="form-control form-select single-select" >
                                                                            <!-- onchange="uom_load()" -->
                                                                            <option value="">Select</option>
                                                                            {% for k in product %}
                                                                            <option value="{{ k.id }}">{{ k.name }}</option> 
                                                                            {% endfor %}
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                


                                                                <div class="col-md-3 mt-3">
                                                                    <label for="bag" class="form-label">Bag</label>
                                                                    <input type="number" class="form-control" id="bag_value" name="bag">
                                                                </div>
                                                            
                                                                <div class="col-md-3 mt-3">
                                                                    <label for="per_bag" class="form-label">Wt. Per Bag</label>
                                                                    <input type="number" class="form-control" id="per_bag" name="per_bag">
                                                                </div>
                                                                <div class="col-md-3 mt-3">
                                                                    <label for="rate" class="form-label">Actual Rate</label>
                                                                    <input type="number" step="0.1" class="form-control" id="actual_rate" name="actual_rate">
                                                                </div> 

                                                                <div class="col-md-3 mt-3">
                                                                     <label for="rate" class="form-label">Discount</label>
                                                                    <input type="number" step="0.1" class="form-control" id="discount" name="discount">
                                                                </div>
                                                            
                                                                
                                                            
                                                                <div class="col-md-3 mt-3">
                                                                    <label for="rate" class="form-label">Rate</label>
                                                                    <input type="number" step="0.1" class="form-control" id="rate" name="rate"  >
                                                                </div>

                                                                <div class="col-md-3 mt-3 mb-3">
                                                                    <label for="quantity" class="form-label">Quantity</label>
                                                                    <input type="number" class="form-control" name="quantity" id="quantity"  >
                                                                </div>

                                                                <div class="col-md-3 mt-3 mb-3">
                                                                    <label for="quantity" class="form-label">Gross Wt.(kg)</label>
                                                                    <input type="number" class="form-control" name="gross_wt" id="gross_wt">
                                                                </div>


                                                                <div class="col-md-3 mt-3">
                                                                    <label for="amount" class="form-label">Amount</label>
                                                                    <input type="number" step="0.1" class="form-control" id="amount" name="amount" >
                                                                </div>
 
                                                                <div class="col-md-3 mt-3 mb-3">
                                                                    <label for="price_list" class="form-label">Price List Details</label>
                                                                    <input type="text" class="form-control" name="price_list" id="price_list">
                                                                </div>



                                                               
                                                                <div class="modal-footer mt-1">
                                                                    <input type="hidden" id="edit_id" name="edit_id">
                                                                    <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
                                                                    <button type="button" id="update" class="btn btn-primary mb-1 " onclick="addManualRow()">Add</button>
                                                                </div>
                                                       
                                                            </div> 
                    
                    
                    
                                                    </div>


                                                  

                                                    <div class="col-md-4" style="border-left: 1px solid #e2e5e8; padding-left: 10px;">
                                                        <!-- <h5 >Deliver To:</h5>  -->
                                                        <section class="hk-sec-wrapper">
                                                            <div class="row">
                                                                <div class="row">
                                                                    <div class="col-md-6 mt-3 ">
                                                                        <label for="company_name" class="form-label">Company Name</label>
                                                                        <input class="form-control" id="company_name" name="company_name" type="text" value="Mirra" placeholder="Name" >
                                                                    </div> 

 
                                                                    
                                                                    <div class="col-md-6 mt-3">
                                                                        <label for="knitting" class="form-label">Knitting</label>
                                                                        <select id="knitting" name="knitting" class="single-select">
                                                                            <option value="company">Select</option>
                                                                            {% for k in party %}
                                                                            <option value="{{k.id}}">{{k.name}}</option>
                                                                            {% endfor %}
                                                                        </select>
                                                                    </div>


                                                                    <div class="col-md-6 mt-3">
                                                                        <label for="ph_email" class="form-label">Delivery Date</label>
                                                                        <input class="form-control" id="deliver_date" name="deliver_date" type="date">
                                                                    </div>


                                                                    
                                                                    <div class="col-md-6 mt-3">
                                                                        <label for="bag" class="form-label">Bag</label>
                                                                        <input class="form-control" id="bags" name="bags" type="number" >
                                                                    </div>
                                                                   
                                                                    
                                                                </div>
                                                                <div class="modal-footer mt-2" >
                                                                    <button type="button" class="btn btn-raised btn-primary me-5 " onclick="addDeliveryRow()">+</button>
                                                                </div>
                                                                <!-- </div> -->
                                                                <div class="row mt-4">
                                                                    <div class="col-sm">
                                                                        <!-- <div class="table-wrap">
                                                                            <table id="delivery_table" class="table table-responsive table-hover w-100 display pb-30"> -->
                                                                              
                                                                            <div class="dt-responsive table-responsive table-hover">
                                                                                <table id="delivery_table"  class="table table-striped table-bordered nowrap">
                                                                                 {% csrf_token %}
                                                                                <thead>
                                                                                    <tr>
                                                                                        <!-- <th>#</th> -->
                                                                                        <th >Company Name</th>
                                                                                        <th>Knitting</th> 
                                                                                        <th>Delivery Date</th>
                                                                                        <th>Bags</th>
                                                                                        <th>Action</th>
                                                                                    </tr> 
                                                                                </thead>
                                                                                <tbody>
                                                                                    <!-- <tr>
                                                                                        <td colspan="5" class="text-center">No data</td>
                                                                                    </tr> -->
                                                                                </tbody>
                                                                            </table>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </section>
                                                        </div>
                                                    </div>


                                                </div> 


                                                
                                                <!-- <form id="add_new"> -->
                                                    <div class="card-body">
                                                        <div class="table-responsive table-desi">
                                                            <table id="purchaseTable" class="table table-striped table-bordered nowrap">
                                                               {% csrf_token %}
                                                                <thead>
                                                                    <tr>
                                                                        <th>Product</th>
                                                                        <th>Rate</th>
                                                                        <th> Bag</th>
                                                                        <th>Per Bag</th>
                                                                        <th>Quantity</th>
                                                                        <th style="display: none"></th>
                                                                        <th>Amount</th>
                                                                        <th>Action</th>

                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <!-- Rows will be dynamically added here -->
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                 
                                                    
                                                <div class="row">
                    
                                                    <div class="col-md-8">
                                                        
                                                    </div>
                                                    <!-- <div class="col-md-3"></div> -->
                                                    <div class="col-md-4">
                                                    <div class=" m-b-30">
                                                        <div class="card-body">            
                                                            <table id="summaryTable" class="table table-striped table-bordered w-100">
                                                                <thead>
                                                                    <tr>
                                                                        <th colspan="2">Summary Table</th>
                                                                    </tr> 
                                                                </thead>
                                                                <tbody>
                                                                    <tr>
                                                                        <td> Total Quantity</td>
                                                                        <td align="end" colspan="2" id="qty_total_placeholder">0</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td>Sub Total</td>
                                                                        <td align="end" colspan="2" id="sub_total_placeholder">0.00</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td>Total Tax</td>
                                                                        <td align="end" colspan="2" id="tax_placeholder">0.00</td>
                                                                    </tr>

                                                                    <tr>
                                                                        <td>Round off</td>
                                                                        <td align="end" colspan="2" id="round_off">0.00</td>
                                                                    </tr>
                                                                    <tr> 
                                                                        <td>Grand Total</td>
                                                                        <td style="background-color: #428bca; color: black; font-size: 21px" align="end" colspan="2" id="total_payable">0.00</td>
                                                                    </tr>
                                                                </tbody>
                                                            </table>     
                                                        </div> 
                                                    </div>
                                                </div>
                                                </div>

                                                <div class="modal-footer" >
                                                    <button type="button" id="cancel" class="btn btn-danger">Close</button>
                                                    <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
                                                    <button type="submit" id="submit_button" class="btn btn-primary">Save</button>


                                                </div>
                                            </div> </form>
                                        </div>
                                    </div>


                                    

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% include 'includes/footer.html' %}


<script>



 
 
function getCSRFToken() {
    const csrfToken = document.cookie.match(/csrftoken=([^;]+)/);
    return csrfToken ? csrfToken[1] : null;
}
$('#add_new').on('submit', function(e) {
    e.preventDefault(); // Prevent default form submission
    console.log("Submit button clicked");  // Debugging 

    var TableData = storeTblValues();
    console.log('tbl-data:', TableData);

    if (TableData.length === 0) {
        notifier.show(
            'Error!', 
            'Table is empty. Please insert the Purchase Order requests.', 
            'success', 
            "{% static 'assets/images/notification/ok-48.png' %}", 
            4000
        ); 
        return;
    } 

    // var DeliveryTableData = storeDeliveryTblValues();
    // console.log('delivery-tbl-data:', DeliveryTableData);

    if (confirm("Are you sure you want to save?")) {
        TableData = JSON.stringify(TableData); 
        var mdata = new FormData(this);
        mdata.append('chemical_data', TableData); 
        console.log('data:', TableData);
        alert('table:',TableData);
        // DeliveryTableData = JSON.stringify(DeliveryTableData);
        // mdata.append('delivery_data', DeliveryTableData); 

        var totalQty = $('#qty_total_placeholder').text();
        var subTotal = $('#sub_total_placeholder').text();
        var taxTotal = $('#tax_placeholder').text();
        var roundOff = $('#round_off').text();
        var totalPayable = $('#total_payable').text();

        // Append total values to FormData
        mdata.append('total_quantity', totalQty);  
        mdata.append('sub_total', subTotal);
        mdata.append('tax_total', taxTotal);
        mdata.append('round_off', roundOff);
        mdata.append('total_payable', totalPayable);

        $.ajax({
            type: "POST",
            url: "/purchase/add-gf-po/",
            data: mdata,
            processData: false,
            contentType: false,
            beforeSend: function(xhr) {
                console.log("Sending AJAX request...");
                $('#submit').attr('disabled', true).text('Processing...');
                // Set the CSRF token in the request header
                xhr.setRequestHeader('X-CSRFToken', getCSRFToken());
            },
            success: function(data) { 
                console.log("Server Response:", data);
                $('#submit').attr('disabled', false).text('Save');
 
                if (data === 'yes') {
                    notifier.show( 
                        'Well Done!', 
                        'PO added!', 
                        'success', 
                        "{% static 'assets/images/notification/ok-48.png' %}", 
                        4000
                    ); 
                    $('#add_new')[0].reset();
                    // location.reload();
                } else {
                    notifier.show(
                        'Error!', 
                        'Failed To add1',  
                        'danger',  
                        "{% static 'assets/images/notification/ok-48.png' %}", 
                        4000 
                    ); 
                }
            },
            error: function(jqXHR, textStatus, errorThrown) {
                console.log("AJAX Error:", textStatus, errorThrown);
                alert('Error Adding data');
                $('#submit').attr('disabled', false).text('Save');
            }
        });
    }
});

 
function LoadDo() {
    var supplier_id = $('#supplier_id').val(); 
    console.log('Supplier-ID:', supplier_id); // Adjusted for clarity
 
    $.ajax({
        type: 'POST',  // Change to POST
        url: '/purchase/get_do_lists/',
        data: {
            'supplier_id': supplier_id,
            'csrfmiddlewaretoken': $('input[name="csrfmiddlewaretoken"]').val()  // Include CSRF token
        },
        success: function(data) {
            $('#do_id').empty().append('<option value="">Select</option>');
            
            if (data.length > 0) {
                data.forEach(function(po) {
                    $('#do_id').append('<option value="' + po.id + '">' + po.do_number + '</option>');
                });
            }
            
        },
        error: function(xhr, status, error) {
            console.error('Error loading po lists:', error);
        } 
    }); 
}





$(document).on('change', '#do_id', function() {
    const supplierId = $('#supplier_id').val();
    const poId = $(this).val(); // Get selected Purchase Order IDs from the multiple select  

    if (!supplierId || !poId) {
        alert("Please select both a Supplier and a Purchase Order.");
        return; // Exit if either is not selected
    }

    // Call the function to load purchases based on the selected supplier and purchase orders
    // LoadDeliver();
    loadPurchases(supplierId, poId);
});



// ``````````````````````````````````````````````````````````````````````````````````````````````````````````````````````


function loadPurchases(supplierId, poIds) {
    const currentLoadedItems = new Set();

    $.ajax({
        type: "GET",
        url: "/purchase/load-delivery-orders/",
        data: {
            supplier_id: supplierId,
            'do_id[]': poIds // Send selected IDs as an array
        },
        success: function(data) {
            if (data.orders && data.orders.length > 0) {
                data.orders.forEach(function(item) {
                    const uniqueKey = `${item.product_id}_${item.tm_id}`;

                    if (!loadedItemsMap[uniqueKey]) {
                        const price = parseFloat(item.rate) || 0;
                        const tax_value = 5; //parseFloat(item.tax_value) || 0;

                        // Add row to table using the new addRow function
                        addRow(item.product, item.rate, item.bag, item.per_bag, item.amount, 
                               price, item.id, item.product_id, 
                               item.tm_id, item.quantity, tax_value, 
                               );
                               
                        loadedItemsMap[uniqueKey] = true; 
                        calculateTotal();
                    }

                    currentLoadedItems.add(uniqueKey);
                });
            } else {
                alert('No unassigned items found or all items are already assigned.');
            }

            // Clean up loaded items
            for (const key in loadedItemsMap) {
                if (!currentLoadedItems.has(key)) {
                    delete loadedItemsMap[key]; 
                }
            }
        },
        error: function(xhr, status, error) {
            alert('Error loading purchases: ' + error);
        }
    }); 
}


const loadedItemsMap = {};



// let rowCounter = 0; // Initialize row counter

// function addRow(product, rate, bag, perBag, amount, price, id, productId, tmId, quantity, taxValue) {
//     // Locate the table body where rows will be added
//     const tableBody = document.querySelector("#purchaseTable tbody");
//     if (!tableBody) {
//         console.error("Table body not found!");
//         return; 
//     } 

//     // Generate a unique rowId using the counter
//     rowCounter++;  // Increment rowCounter for each new row
//     const rowId = `row_${rowCounter}`;  // Create a unique ID for the row

//     // Create a new table row
//     const newRow = document.createElement("tr");
//     newRow.setAttribute("data-product-id", productId); ;
//     newRow.setAttribute("data-tm-id", tmId);
//     newRow.setAttribute("data-row-id", rowId); // Set rowId as data attribute for identification
    
//     newRow.innerHTML = `
//         <td>${product}</td> 
//         <td><input type="number" class="rate" name="rate" value="${(parseFloat(rate) || 0).toFixed(2)}" data-row-id="${rowId}"></td>
//         <td><input type="number" class="bag" name="bag" value="${bag}" max="${bag}" data-row-id="${rowId}"></td>
//         <td><input type="number" class="per_bag" name="per_bag" value="${perBag}" max="${perBag}" data-row-id="${rowId}"></td>
//         <td><input type="number" class="quantity" name="quantity" value="${quantity}" min="1" max="${quantity}" data-row-id="${rowId}"></td>
//         <td><input type="number" class="amount" name="amount" value="${(parseFloat(amount) || 0).toFixed(2)}" disabled data-row-id="${rowId}"></td>
//         <td style="display:none">${taxValue}%</td>
//         <td id="tm_id" style="display:none">${tmId}</td>
//         <td id="id" style="display:none">${id}</td>
//         <td id="product_id" style="display:none">${productId}</td>
//         <td> 
//             <button class="btn btn-danger btn-xs remove-row"><i class='feather icon-trash-2'></i></button>
//         </td>
//     `;
 
//     // Append the new row to the table body
//     tableBody.appendChild(newRow);
//     calculateTotal();

//     // Add event listener to remove row button
//     newRow.querySelector(".remove-row").addEventListener("click", function() {
//         newRow.remove();
//     });

//     // Attach event listeners for real-time calculations
//     newRow.querySelector('.rate').addEventListener("input", calculateRow);
//     newRow.querySelector('.bag').addEventListener("input", calculateRow);
//     newRow.querySelector('.per_bag').addEventListener("input", calculateRow);
//     newRow.querySelector('.quantity').addEventListener("input", calculateRow);
// }




// function calculateTotal() {
//     let totalQuantity = 0;
//     let subTotal = 0;
//     let taxTotal = 0;
//     let grandTotal = 0;

//     $("#purchaseTable tbody tr").each(function() {
//         let quantity = parseFloat($(this).find(".quantity").val()) || 0;
//         let rate = parseFloat($(this).find(".rate").val()) || 0;
//         let taxValue = parseFloat($(this).find("td:eq(6)").text().replace("%", "")) || 0; // Extract tax percentage

//         let amount = quantity * rate;
//         let taxAmount = (amount * taxValue) / 100;

//         // Update row-wise amount
//         $(this).find(".amount").val(amount.toFixed(2));

//         // Accumulate totals
//         totalQuantity += quantity;
//         subTotal += amount;
//         taxTotal += taxAmount;
//     });

//     // Compute Grand Total & Round Off
//     grandTotal = subTotal + taxTotal;
//     let roundOff = Math.round(grandTotal) - grandTotal;

//     //  Update Summary Table
//     $("#qty_total_placeholder").text(totalQuantity);
//     $("#sub_total_placeholder").text(subTotal.toFixed(2));
//     $("#tax_placeholder").text(taxTotal.toFixed(2));
//     $("#round_off").text(roundOff.toFixed(2));
//     $("#total_payable").text((grandTotal + roundOff).toFixed(2));
// }


// function storeTblValues() {
//     var TableData = [];

//     // Iterate over each row in the table
//     $('#productstable tbody tr').each(function(row, tr) {
//         // Extracting data from the row
//         var product_id = $(tr).find('td:eq(5)').find('span').text(); // Assuming product ID is in the 8th column (index 7)
//         var product_name = $(tr).find('td:eq(0)').text(); // Product Name
//         var bag = $(tr).find('td:eq(1)').text(); // Bag
//         var per_bag = $(tr).find('td:eq(2)').text(); // Per Bag 
//         var quantity = $(tr).find('td:eq(3)').text(); // Quantity
//         var rate = $(tr).find('td:eq(4)').text(); // Rate
//         var actual_rate = $(tr).find('td:eq(6)').text(); // Rate
//         var discount = $(tr).find('td:eq(7)').text(); // Rate
//         var gross_wt = $(tr).find('td:eq(8)').text(); // Rate
//         var amount = $(tr).find('td:eq(9)').text(); // Amount

//         // Debugging: Check if any required data is missing
//         console.log("Row Data:", {
//             product_id: product_id,
//             product_name: product_name,
//             bag: bag, 
//             per_bag: per_bag,
//             quantity: quantity,
//             rate: rate,
//             amount: amount
//         });

//         // Ensure product_id is available and then push the data to TableData
//         if (product_id && quantity && rate && amount) {
//             TableData.push({
//                 "product_id": product_id,
//                 "product_name": product_name,
//                 "bag": bag,
//                 "per_bag": per_bag,
//                 "quantity": quantity, 
//                 "rate": rate,
//                 "amount": amount,
//                 'actual_rate':actual_rate,
//                 'discount':discount,
//                 'gross_wt':gross_wt,
//             });
//         } else {
//             console.log("Missing data for row, skipping...");
//         }
//     });

//     console.log('Store Table Values:', TableData);
//     return TableData;
// }




// // Calculation function for the row
// function calculateRow(event) {
//     var rowId = event.target.getAttribute('data-row-id');
//     var row = document.querySelector(`[data-row-id="${rowId}"]`).closest('tr');
    
//     var bagElement = row.querySelector('.bag');
//     var perBagElement = row.querySelector('.per_bag');
//     var quantityElement = row.querySelector('.quantity');
//     var rateElement = row.querySelector('.rate');
    
//     if (bagElement && perBagElement && quantityElement && rateElement) {
//         // Calculate quantity based on bag and per_bag
//         var bag = parseFloat(bagElement.value) || 0;
//         var perBag = parseFloat(perBagElement.value) || 0;
//         var quantity = bag * perBag;
//         quantityElement.value = quantity;

//         // Calculate amount based on quantity and rate
//         var rate = parseFloat(rateElement.value) || 0;
//         var amount = quantity * rate;
//         row.querySelector('.amount').value = amount.toFixed(2);
//     } else {
//         console.error('Missing elements in the row.');
//     }
//     calculateTotal();
// }



// const loadedItemsMap = {};
let rowCounter = 0; // Initialize row counter

// function addRow(product, rate, bag, perBag, amount, price, id, productId, tmId, quantity, taxValue) {
//     const tableBody = document.querySelector("#purchaseTable tbody");
//     if (!tableBody) {
//         console.error("Table body not found!");
//         return;
//     }

//     rowCounter++; // Increment rowCounter for each new row
//     const rowId = `row_${rowCounter}`; // Create a unique ID for the row

//     const newRow = document.createElement("tr");
//     newRow.setAttribute("data-product-id", productId);
//     newRow.setAttribute("data-tm-id", tmId);
//     newRow.setAttribute("data-row-id", rowId);

//     newRow.innerHTML = `
//         <td>${product}</td>
//         <td><input type="number" class="rate" name="rate" value="${(parseFloat(rate) || 0).toFixed(2)}" data-row-id="${rowId}"></td>
//         <td><input type="number" class="bag" name="bag" value="${bag}" max="${bag}" data-row-id="${rowId}"></td>
//         <td><input type="number" class="per_bag" name="per_bag" value="${perBag}" max="${perBag}" data-row-id="${rowId}"></td>
//         <td><input type="number" class="quantity" name="quantity" value="${quantity}" min="1" max="${quantity}" data-row-id="${rowId}"></td>
//         <td><input type="number" class="amount" name="amount" value="${(parseFloat(amount) || 0).toFixed(2)}" disabled data-row-id="${rowId}"></td>
//         <td style="display:none">${taxValue}%</td>
//         <td id="tm_id" style="display:none">${tmId}</td>
//         <td id="id" style="display:none">${id}</td>
//         <td id="product_id" style="display:none">${productId}</td>
//         <td><button class="btn btn-danger btn-xs remove-row"><i class='feather icon-trash-2'></i></button></td>
//     `;

//     tableBody.appendChild(newRow);
//     calculateTotal();

//     // **Event Listeners for Manual Entry Updates**
//     $(newRow).find(".rate, .quantity, .bag, .per_bag").on("input", function () {
//         calculateRow(this);
//         calculateTotal();
//     });

//     // **Remove Row Event**
//     $(newRow).find(".remove-row").on("click", function () {
//         $(newRow).remove();
//         calculateTotal(); // Update totals after deletion
//     });
// }

function addManualRow() {
    console.log("Manual row function triggered");

    const product = $("#product_id option:selected").text();
    const productId = $("#product_id").val();
    const rate = $("#rate").val();
    const bag = $("#bag_value").val();
    const perBag = $("#per_bag").val();
    const quantity = $("#quantity").val();
    const amount = $("#amount").val();
    const tmId = null;
    const taxValue = 5;

    if (!productId || !rate || !quantity) {
        alert("Please fill in all required fields.");
        return;
    }

    addRow(product, rate, bag, perBag, amount, rate, null, productId, tmId, quantity, taxValue);
}


function addRow(
    product, rate, bag, perBag, amount, price, id, productId, tmId, quantity, taxValue
) {
    console.log("Adding Row - Received Values:", { product, rate, bag, perBag, amount, price, id, productId, tmId, quantity, taxValue });

    // Ensure values are not undefined
    product = product || "Unknown";
    rate = parseFloat(rate) || 0;
    bag = parseInt(bag) || 0;
    perBag = parseInt(perBag) || 0;
    amount = parseFloat(amount) || 0;
    quantity = parseInt(quantity) || 0;
    taxValue = parseFloat(taxValue) || 0;

    const tableBody = document.querySelector("#purchaseTable tbody");
    if (!tableBody) {
        console.error("Table body not found!");
        return;
    }

    rowCounter++;
    const rowId = `row_${rowCounter}`;

    const newRow = document.createElement("tr");
    newRow.setAttribute("data-product-id", productId || "N/A");
    newRow.setAttribute("data-tm-id", tmId || "N/A");
    newRow.setAttribute("data-row-id", rowId);

    newRow.innerHTML = `
        <td>${product}</td>
        <td><input type="number" class="rate" name="rate" value="${rate.toFixed(2)}" data-row-id="${rowId}"></td>
        <td><input type="number" class="bag" name="bag" value="${bag}" max="${bag}" data-row-id="${rowId}"></td>
        <td><input type="number" class="per_bag" name="per_bag" value="${perBag}" max="${perBag}" data-row-id="${rowId}"></td>
        <td><input type="number" class="quantity" name="quantity" value="${quantity}" min="1" max="${quantity}" data-row-id="${rowId}"></td>
        <td><input type="number" class="amount" name="amount" value="${amount.toFixed(2)}" disabled data-row-id="${rowId}"></td>
        <td id="product_id" style="display:none">${productId || "N/A"}</td>

        <td style="display:none">${taxValue}%</td>
        <td id="tm_id" style="display:none">${tmId || "N/A"}</td>
        <td id="id" style="display:none">${id || "N/A"}</td>
        <td><button class="btn btn-danger btn-xs remove-row"><i class='feather icon-trash-2'></i></button></td>
    `;

    tableBody.appendChild(newRow);
    calculateTotal();

    $(newRow).find(".rate, .quantity, .bag, .per_bag").on("input", function () {
        calculateRow(this);
        calculateTotal();
    });

    $(newRow).find(".remove-row").on("click", function () {
        $(newRow).remove();
        calculateTotal();
    });

    console.log("Row added successfully:", newRow);
}

// function addRow(
//     product = "Unknown", 
//     rate = 0, 
//     bag = 0, 
//     perBag = 0, 
//     amount = 0, 
//     price = 0, 
//     id = null, 
//     productId = null, 
//     tmId = null, 
//     quantity = 0, 
//     taxValue = 0
// ) {
//     // Debugging: Log values being passed to the function
//     console.log("Adding Row - Received Values:", { product, rate, bag, perBag, amount, price, id, productId, tmId, quantity, taxValue });

//     // Validate Inputs to Prevent "undefined" Errors
//     rate = parseFloat(rate) || 0;
//     bag = parseInt(bag) || 0;
//     perBag = parseInt(perBag) || 0;
//     amount = parseFloat(amount) || 0;
//     quantity = parseInt(quantity) || 0;
//     taxValue = parseFloat(taxValue) || 0;

//     const tableBody = document.querySelector("#purchaseTable tbody");
//     if (!tableBody) {
//         console.error("Table body not found!");
//         return;
//     }

//     rowCounter++; // Increment row counter
//     const rowId = `row_${rowCounter}`; // Create unique row ID

//     // Create a new table row
//     const newRow = document.createElement("tr");
//     newRow.setAttribute("data-product-id", productId || "N/A");
//     newRow.setAttribute("data-tm-id", tmId || "N/A");
//     newRow.setAttribute("data-row-id", rowId);

//     newRow.innerHTML = `
//         <td>${product || "Unknown"}</td>
//         <td><input type="number" class="rate" name="rate" value="${rate.toFixed(2)}" data-row-id="${rowId}"></td>
//         <td><input type="number" class="bag" name="bag" value="${bag}" max="${bag}" data-row-id="${rowId}"></td>
//         <td><input type="number" class="per_bag" name="per_bag" value="${perBag}" max="${perBag}" data-row-id="${rowId}"></td>
//         <td><input type="number" class="quantity" name="quantity" value="${quantity}" min="1" max="${quantity}" data-row-id="${rowId}"></td>
//         <td><input type="number" class="amount" name="amount" value="${amount.toFixed(2)}" disabled data-row-id="${rowId}"></td>
//         <td style="display:none">${taxValue}%</td>
//         <td id="tm_id" style="display:none">${tmId || "N/A"}</td>
//         <td id="id" style="display:none">${id || "N/A"}</td>
//         <td id="product_id" style="display:none">${productId || "N/A"}</td>
//         <td><button class="btn btn-danger btn-xs remove-row"><i class='feather icon-trash-2'></i></button></td>
//     `;

//     tableBody.appendChild(newRow);
//     calculateTotal();

//     // Add event listeners for calculations
//     $(newRow).find(".rate, .quantity, .bag, .per_bag").on("input", function () {
//         calculateRow(this);
//         calculateTotal();
//     });

//     // Remove row event
//     $(newRow).find(".remove-row").on("click", function () {
//         $(newRow).remove();
//         calculateTotal();
//     });

//     console.log("Row added successfully:", newRow);
// }


function calculateRow(input) {
    const row = $(input).closest("tr");
    let rate = parseFloat(row.find(".rate").val()) || 0;
    let quantity = parseFloat(row.find(".quantity").val()) || 0;
    let amount = rate * quantity;
    row.find(".amount").val(amount.toFixed(2));
}

function calculateTotal() {
    let totalQuantity = 0;
    let subTotal = 0;
    let taxTotal = 0;
    let grandTotal = 0;

    $("#purchaseTable tbody tr").each(function () {
        let quantity = parseFloat($(this).find(".quantity").val()) || 0;
        let rate = parseFloat($(this).find(".rate").val()) || 0;
        let taxValue = parseFloat($(this).find("td:eq(6)").text().replace("%", "")) || 0;

        let amount = quantity * rate;
        let taxAmount = (amount * taxValue) / 100;

        $(this).find(".amount").val(amount.toFixed(2));

        totalQuantity += quantity;
        subTotal += amount;
        taxTotal += taxAmount;
    });

    grandTotal = subTotal + taxTotal;
    let roundOff = Math.round(grandTotal) - grandTotal;

    // âœ… **Update Summary Table**
    $("#qty_total_placeholder").text(totalQuantity);
    $("#sub_total_placeholder").text(subTotal.toFixed(2));
    $("#tax_placeholder").text(taxTotal.toFixed(2));
    $("#round_off").text(roundOff.toFixed(2));
    $("#total_payable").text((grandTotal + roundOff).toFixed(2));
}

// **Trigger Recalculation When Manual Entries are Made**
$(document).on("input", ".rate, .quantity, .bag, .per_bag", function () {
    calculateRow(this);
    calculateTotal();
});

// `````````````````````````````````  


// function storeTblValues() {
//     var TableData = [];

//     // Iterate over each row in the table
//     $('#purchaseTable tbody tr').each(function(row, tr) {
//         // Extracting data from the row
//         var product_id = $(tr).find('td:eq(9)').find('span').text(); // Assuming product ID is in the 8th column (index 7)
//         var product_name = $(tr).find('td:eq(0)').text(); // Product Name
//         var bag = $(tr).find('td:eq(1)').text(); // Bag
//         var per_bag = $(tr).find('td:eq(2)').text(); // Per Bag 
//         var quantity = $(tr).find('td:eq(3)').text(); // Quantity
//         var rate = $(tr).find('td:eq(4)').text(); // Rate
//         // var actual_rate = $(tr).find('td:eq(6)').text(); // Rate
//         // var discount = $(tr).find('td:eq(7)').text(); // Rate
//         // var gross_wt = $(tr).find('td:eq(8)').text(); // Rate
//         // var amount = $(tr).find('td:eq(9)').text(); // Amount

//         // // Debugging: Check if any required data is missing
//         console.log("Row Data:", {
//             product_id: product_id,
//             product_name: product_name,
//             bag: bag, 
//             per_bag: per_bag,
//             quantity: quantity,
//             rate: rate,
//             amount: amount
//         });

//         // Ensure product_id is available and then push the data to TableData
//         if (product_id && quantity && rate && amount) {
//             TableData.push({
//                 "product_id": product_id,
//                 "product_name": product_name,
//                 "bag": bag,
//                 "per_bag": per_bag,
//                 "quantity": quantity, 
//                 "rate": rate,
//                 "amount": amount,
//                 // 'actual_rate':actual_rate,
//                 // 'discount':discount,
//                 // 'gross_wt':gross_wt,
//             });
//         } else {
//             console.log("Missing data for row, skipping...");
//         }
//     });

//     console.log('Store Table Values:', TableData);
//     return TableData;
// }



function storeTblValues() {
    var TableData = [];

    $('#purchaseTable tbody tr').each(function(row, tr) {
        // Fix: Get product_id using td#product_id
        var product_id = $(tr).find('td#product_id').text().trim();  // Correct selector for product_id
        var product_name = $(tr).find('td:eq(0)').text().trim();  // First column for product name
        var bag = $(tr).find('td:eq(1) input').val().trim();  // Bag value (from input field)
        var per_bag = $(tr).find('td:eq(2) input').val().trim();  // Per Bag value (from input field)
        var quantity = $(tr).find('td:eq(3) input').val().trim();  // Quantity (from input field)
        var rate = $(tr).find('td:eq(4) input').val().trim();  // Rate value (from input field)
        var amount = $(tr).find('td:eq(5) input').val().trim();  // Amount (from input field)

        console.log("Row Data:", {
            product_id: product_id,
            product_name: product_name,
            bag: bag,
            per_bag: per_bag,
            quantity: quantity,
            rate: rate,
            amount: amount
        });

        // Check if any required data is missing before pushing to TableData
        if (product_id && quantity && rate && amount) {
            TableData.push({
                product_id: product_id,
                product_name: product_name,
                bag: bag,
                per_bag: per_bag,
                quantity: quantity,
                rate: rate,
                amount: amount
            });
        } else {
            console.log("Skipping row due to missing data...");
        }
    });

    console.log('Final Table Data:', TableData);
    return TableData;
}



function storeTblValuestesttt() {
    var TableData = [];

    $('#purchaseTable tbody tr').each(function(row, tr) {
        var product_id = $(tr).find('td:eq(6) span').text().trim();
        var product_name = $(tr).find('td:eq(0)').text().trim();
        var bag = $(tr).find('td:eq(1)').text().trim();
        var per_bag = $(tr).find('td:eq(2)').text().trim();
        var quantity = $(tr).find('td:eq(3) input').val().trim();  // If it's an input field
        var rate = $(tr).find('td:eq(4) input').val().trim();
        var amount = $(tr).find('td:eq(5)').text().trim();

        console.log("Row Data:", {
            product_id: product_id,
            product_name: product_name,
            bag: bag,
            per_bag: per_bag,
            quantity: quantity,
            rate: rate,
            amount: amount
        });

        if (product_id && quantity && rate && amount) {
            TableData.push({
                product_id: product_id,
                product_name: product_name,
                bag: bag,
                per_bag: per_bag,
                quantity: quantity,
                rate: rate,
                amount: amount
            });
        } else {
            console.log("Skipping row due to missing data...");
        }
    });

    console.log('Final Table Data:', TableData);
    return TableData;
}

 
function storeDeliveryTblValues() { 
    var TableData = [];
    $('#delivery_table tr').each(function(row, tr) {
        TableData[row] = {
            "company_name": $(tr).find('td:eq(0)').text(),
            "knitting": $(tr).find('td:eq(1)').text(), 
            "delivery_date": $(tr).find('td:eq(2)').text(),
            "bags": $(tr).find('td:eq(3)').text()   // Add this line
        };
    });
    TableData.shift();   // Remove the first empty row
    return TableData;
    console.log('table-data:',TableData);
    console.log('bags:',bags);
}



// var first = true;  // Declare 'first' globally


let totalBagsInTable = 0; // Track the total number of bags entered in the delivery table
    let bagLimit = 0; // This will store the value entered in the "Bag" field

    // When the user enters a value in the "Bag" field, update the bag limit
    document.getElementById("bag").addEventListener("input", function() {
        bagLimit = parseInt(this.value); // Update the allowed number of bags
        console.log('bags:',bagLimit);
        totalBagsInTable = 0; // Reset total bags in the table
        updateDeliveryTableLimit(); // Update the max value for the input field in delivery table
    });

    function updateDeliveryTableLimit() { 
        const rows = document.querySelectorAll("#delivery_table tbody tr");
        rows.forEach(row => {
            let bagInput = row.querySelector(".bags-in-delivery");
            bagInput.setAttribute("max", bagLimit - totalBagsInTable); // Set max to remaining bags
        });
    }










// ``````````````````````` delivery table data ````````````````````````````````
function addDeliveryRow() {
    let deliveryTable = document.getElementById("delivery_table").getElementsByTagName("tbody")[0];
    
    // Ensure the tbody exists
    if (!deliveryTable) {
        console.error('Table body does not exist.');
        return;
    }

    // Get the value of total bags allowed from the input field (bag_value)
    let totalBags = parseInt(document.getElementById("bag_value").value); // Total number of bags allowed (bag_value)
    
    // Check if bag_value is empty
    if (isNaN(totalBags) || totalBags <= 0) {
        alert("Please enter a valid value for 'Bag' before adding rows.");
        return;
    }

    let rowCount = deliveryTable.rows.length;
    let usedBags = 0;

    // Calculate how many bags have already been used in the delivery table
    for (let i = 0; i < rowCount; i++) {
        let bagsInput = deliveryTable.rows[i].cells[3] && deliveryTable.rows[i].cells[3].getElementsByTagName("input")[0];
        if (bagsInput) {
            usedBags += parseInt(bagsInput.value || 0); // Sum of all "Bags" values
        }
    }

    let remainingBags = totalBags - usedBags;

    // Check if remaining bags are available
    if (remainingBags <= 0) {
        alert("No more bags are available to add.");
        return;
    }

    // Get the bags value from the input field to be added (max remaining bags)
    let bagsToAdd = parseInt(document.getElementById("bags").value); // Bags value entered for the new row
    if (bagsToAdd > remainingBags) {
        alert(`You can only add up to ${remainingBags} bags.`);
        return;
    }

    // Create a new row
    let newRow = deliveryTable.insertRow(rowCount);
    // let cell1 = newRow.insertCell(0);
    let cell2 = newRow.insertCell(0);
    let cell3 = newRow.insertCell(1);
    let cell4 = newRow.insertCell(2);
    let cell5 = newRow.insertCell(3);
    let cell6 = newRow.insertCell(4); // New cell for the "Remove" button



    // let cell2 = newRow.insertCell(1);
    // let cell3 = newRow.insertCell(2);
    // let cell4 = newRow.insertCell(3);
    // let cell5 = newRow.insertCell(4);
    // let cell6 = newRow.insertCell(5); // New cell for the "Remove" button

    var company_name = $('#company_name').val();
    var knitting = $('#knitting').val();
    var delivery_date = $('#deliver_date').val();

    // Create and append the new row content
    // cell1.innerHTML = rowCount + 1; // row number
    cell2.innerHTML = company_name;//`<input type="text" class="form-control" name="company_name" value="${company_name}"  />`;
    cell3.innerHTML =knitting; // `<input type="number" class="form-control" name="knitting" value="${knitting}"  />`;
    cell4.innerHTML = delivery_date; //`<input type="text" class="form-control" name="deliver_date" value="${delivery_date}" />`;
    cell5.innerHTML = bagsToAdd  //`<input type="number" class="form-control bags-in-delivery" name="bags" value="${bagsToAdd}" max="${remainingBags}" style=" width:70px"/>`;

    // Add "Remove" button in the new row
    cell6.innerHTML = `<button type="button" class="btn btn-xs btn-danger remove-row"><i class="feather icon-trash-2"></i></button>`;

    // Attach the input change event to track the value of bags in each row
    let bagsInput = newRow.cells[3].getElementsByTagName("input")[0];
    bagsInput.addEventListener("input", function () {
        let enteredBags = parseInt(bagsInput.value) || 0;

        // Ensure entered bags do not exceed remaining bags
        if (enteredBags > remainingBags) {
            alert(`You cannot enter more than ${remainingBags} bags.`);
            bagsInput.value = remainingBags; // Set the value to the max allowed
        }
    });

    // Add event listener for "Remove" button
    let removeButton = newRow.cells[4].getElementsByClassName("remove-row")[0];
    removeButton.addEventListener("click", function() {
        // Confirm before removing the row
        if (confirm("Are you sure you want to remove this row?")) {
            newRow.remove();
            updateRowNumbers(); // Update row numbers after removal
        }
    });
}

// Function to update row numbers after a row is removed
function updateRowNumbers() {
    let deliveryTable = document.getElementById("delivery_table").getElementsByTagName("tbody")[0];
    let rows = deliveryTable.rows;

    // Update row numbers
    for (let i = 0; i < rows.length; i++) {
        rows[i].cells[0].innerHTML = i + 1; // Set the first cell to reflect the correct row number
    }
}




    // Calculate the total bags in the delivery table
    function updateTotalBagsInTable() {
        totalBagsInTable = 0;
        const rows = document.querySelectorAll("#delivery_table tbody tr");
        rows.forEach(row => {
            let bagInput = row.querySelector(".bags-in-delivery");
            if (bagInput) {
                totalBagsInTable += parseInt(bagInput.value || 0);
            }
        });
        updateDeliveryTableLimit(); // Update the max value for the input field based on total bags
    }

    // // Listen for the submit event to make sure the total bags in table don't exceed the limit
    document.getElementById("add_new").addEventListener("submit", function(e) {
        if (totalBagsInTable !== bagLimit) {
            e.preventDefault(); // Prevent form submission
            alert("Total bags in delivery table must equal the value in the Bag field.");
        }
    });


// ````````````````````````````````````````````````````````````````````````````````````````
    document.addEventListener('DOMContentLoaded', function () {
        // Get the input fields for bag and per_bag
        const bagField = document.getElementById('bag');
        const perBagField = document.getElementById('per_bag');
        const grossWtField = document.getElementById('gross_wt');

        // Function to calculate and update gross weight
        function calculateGrossWeight() {
            const bags = parseFloat(bagField.value) || 0;  // Get number of bags
            const perBag = parseFloat(perBagField.value) || 0;  // Get weight per bag

            // Calculate gross weight
            const grossWeight = bags * perBag;

            // Update the gross weight field 
            grossWtField.value = grossWeight.toFixed(2);
        }

        // Add event listeners for the fields
        bagField.addEventListener('input', calculateGrossWeight);
        perBagField.addEventListener('input', calculateGrossWeight);
    });



    


document.addEventListener('DOMContentLoaded', function () {
        // Get all input fields
        const actualRateField = document.getElementById('actual_rate');
        const discountField = document.getElementById('discount');
        const rateField = document.getElementById('rate');
        const quantityField = document.getElementById('quantity');
        const grossWtField = document.getElementById('gross_wt');
        const amountField = document.getElementById('amount');

        // Function to calculate and update fields
        function calculateRateAndAmount() {
            const actualRate = parseFloat(actualRateField.value) || 0;
            const discount = parseFloat(discountField.value) || 0;

            // Calculate rate based on discount
            const discountedRate = actualRate - (actualRate * (discount / 100));

            // Update the rate field 
            rateField.value = discountedRate.toFixed(2);

            // Calculate amount
            const quantity = parseFloat(quantityField.value) || 0;
            const grossWt = parseFloat(grossWtField.value) || 0;
            let amount = 0;

            // If quantity is provided, calculate amount based on quantity
            if (quantity > 0) {
                amount = discountedRate * quantity;
            }
            // If gross weight is provided, calculate amount based on gross weight
            else if (grossWt > 0) {
                amount = discountedRate * grossWt;
            }

            // Update the amount field
            amountField.value = amount.toFixed(2);
        }

        // Add event listeners for the fields
        actualRateField.addEventListener('input', calculateRateAndAmount);
        discountField.addEventListener('input', calculateRateAndAmount);
        quantityField.addEventListener('input', calculateRateAndAmount);
        grossWtField.addEventListener('input', calculateRateAndAmount);
    });

    

    
 
 
document.addEventListener("DOMContentLoaded", function () {
    // Attach event listeners for real-time calculations
    document.getElementById("bag_value").addEventListener("input", calculateQuantity);
    document.getElementById("per_bag").addEventListener("input", calculateQuantity);
    document.getElementById("rate").addEventListener("input", calculateAmount);
    document.getElementById("rate").addEventListener("input", calculateAmount);
    const grossWtField = document.getElementById('gross_wt'); 

});


function calculateGrossWeight() {
            const bags = parseFloat(document.getElementById("bag_value").value) || 0;  // Get number of bags
            const perBag = parseFloat(document.getElementById("per_bag").value) || 0;

            // Calculate gross weight
            const grossWeight = bags * perBag;
            alert('gross-wt.:',grossWeight);

            // Update the gross weight field
            grossWtField.value = grossWeight.toFixed(2);
        }

        // Add event listeners for the fields
        bagField.addEventListener('input', calculateGrossWeight);
        perBagField.addEventListener('input', calculateGrossWeight);
    // });

function calculateQuantity() {
    var bag = parseFloat(document.getElementById("bag_value").value) || 0;
    var perBag = parseFloat(document.getElementById("per_bag").value) || 0;
    var quantity = bag * perBag;
    document.getElementById("quantity").value = quantity;

    // Auto-update amount if rate is already entered
    calculateAmount();
}

function calculateAmount() {
    var quantity = parseFloat(document.getElementById("quantity").value) || 0;
    var rate = parseFloat(document.getElementById("rate").value) || 0;
    var amount = quantity * rate;
    document.getElementById("amount").value = amount.toFixed(2);
}






</script>
<script>


 
$('.single-select').select2();

            // Get current date and time
            const currentDate = new Date();
    const currentDateString = currentDate.toISOString().slice(0, 10); // Format as YYYY-MM-DD
    const currentTimeString = currentDate.toTimeString().slice(0, 5); // Format as HH:MM

    // Set default values for date and time fields
    document.getElementById('purchase_date').value = currentDateString;
    document.getElementById('delivery_date').value = currentDateString;
    document.getElementById('deliver_date').value = currentDateString;
    // document.getElementById('purchase_time').value = currentTimeString;




    
    
    function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
// });


 </script>
