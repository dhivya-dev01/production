{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>MIRRA GARMENTS - GREY FABRIC OUTWARD</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/7.0.0/normalize.min.css">
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Roboto&display=swap');

      @page {
        size: A4 landscape;
        margin: 1cm;
      }

      @media print {
        header, footer {
          display: block;
        }

        thead {
          display: table-header-group;
        }

        tfoot {
          display: table-footer-group;
        }

        tr {
          page-break-inside: avoid;
        }

        table {
          page-break-inside: auto;
          width: 100%;
        }

        .page-break {
          page-break-before: always;
        }
      }

      body {
        width: 29.7cm;
        height: 21cm;
        margin: 0 auto;
        padding: 1cm;
        font-family: Roboto, Arial, sans-serif;
        font-size: 12px;
        color: #001028;
        background: #FFFFFF;
      }

      header {
        margin-bottom: 10px;
      }

      footer {
        bottom: 0px;
      }

      p {
        font-size: 8pt;
        margin: 0;
      }

      .table > tbody > tr > td,
      .table > tbody > tr > th,
      .table > tfoot > tr > td,
      .table > tfoot > tr > th,
      .table > thead > tr > td,
      .table > thead > tr > th {
        padding: 4px;
      }
    </style>
  </head>
  <body>
    <header id="page-header">
      <table width="100%">
        <tr>
          <td width="35%"><img width="140" height="70" src="{{ image_url }}"/></td>
          <td width="65%" align="right">
            <h4><strong>{{ company.name.upper }}</strong></h4>
            <p>#73 Devji Colony, B.S. Sundaram Road, Tirupur-641604</p>
            <p><b>Cell:</b> {{ company.mobile }} | <b>Phone:</b> {{ company.phone }}</p>
            <p><b>Email:</b> {{ company.email }}</p>
            <p><b>GSTIN:</b> {{ company.gstin }}</p>
          </td>
        </tr>
      </table>
    </header>

    <section class="sheet" style="padding:20px">
      <hr>
      <table width="100%">
        <tr>
          <td align="left"><p><strong>OUTWARD No. :</strong> {{ delivery_data.do_number }}</p></td>
          <td align="center">
            <div style="width: 140px; border:2px solid black; text-align:center; padding:3px;">
              <p><strong>GREY FABRIC OUTWARD</strong></p>
            </div>
          </td>
          <td align="right"><p><strong>OUTWARD DATE:</strong> {{ delivery_data.delivery_date|date:"d-m-Y" }}</p></td>
        </tr>
      </table>

      <hr>

      <table width="100%">
        <tr>
          <td align="left">
            <p>To M/S: <strong>{{ party_name.name }}</strong></p>
            <p>GSTIN: <strong>{{ gstin }}</strong></p>
            <p>Mobile: <strong>{{ mobile }}</strong></p>
          </td>
          <td align="right">
            <p><strong>Prev. Out Quantity:</strong> {{ previous_no|floatformat:3 }}</p>
          </td>
        </tr>
      </table>

      <table class="table table-striped table-bordered">
        <tbody>
          <tr>
            <td colspan="4" align="center"><strong>DELIVERY INFORMATION</strong></td>
          </tr>
          <tr>
            <td colspan="2" align="left">
              <p><strong>LOT No./Name:</strong> {{ delivery_data.lot_no }} / {{ total_values.name }}</p>
            </td>
            {% for group in grouped_delivery_details %}
              <td colspan="2" align="right">
                <p><strong>Fabric:</strong> {{ group.fabric }} / {{ group.yarn }} / {{ group.gauge }} / {{ group.tex }} / {{ group.gsm }}</p>
              </td>
            {% endfor %}
          </tr>
        </tbody>
      </table>

      <table class="table table-striped table-bordered">
        <thead>
          <tr>
            <th>Color</th>
            {% for dia in dias %}
              <th colspan="2" style="text-align:center;">{{ dia }}</th>
            {% endfor %}
            <th colspan="2" style="text-align:center;">Total</th>
          </tr>
          <tr>
            <th></th>
            {% for dia in dias %}
              <th style="text-align:center;">Roll</th>
              <th style="text-align:center;">Weight</th>
            {% endfor %}
            <th style="text-align:center;">Roll</th>
            <th style="text-align:center;">Weight</th>
          </tr>
        </thead>
        <tbody>
          {% for fabric_group in grouped_delivery_details %}
            {% for color_group in fabric_group.color_groups %}
              <tr>
                <td>{{ color_group.color }}</td>
                {% for dia in dias %}
                  {% with dia_data=None %}
                    {% for d in color_group.dias %}
                      {% if d.dia == dia %}
                        <td align="center">{{ d.roll|floatformat:0 }}</td>
                        <td align="center">{{ d.roll_wt|floatformat:3 }}</td>
                        {% with dia_data=1 %}{% endwith %}
                      {% endif %}
                    {% endfor %}
                  {% endwith %}
                {% endfor %}
                <td align="center"><strong>{{ color_group.total_roll|floatformat:0 }}</strong></td>
                <td align="center"><strong>{{ color_group.total_weight|floatformat:3 }}</strong></td>
              </tr>
            {% endfor %}
          {% endfor %}
        </tbody>
        <tfoot>
          <tr>
            <td align="right"><strong>Total</strong></td>
            {% for total in dia_totals_list %}
              <td align="center"><strong>{{ total.roll|floatformat:0 }}</strong></td>
              <td align="center"><strong>{{ total.roll_wt|floatformat:2 }}</strong></td>
            {% endfor %}
            <td align="center"><strong>{{ grand_total_roll|floatformat:0 }}</strong></td>
            <td align="center"><strong>{{ grand_total_weight|floatformat:3 }}</strong></td>
          </tr>
        </tfoot>
      </table>


<!-- 
      <table class="table table-striped table-bordered">
  <thead>
    <tr>
      <th>Color</th>
      {% for dia in dias %}
        <th colspan="2" style="text-align:center;">{{ dia }}</th>
      {% endfor %}
      <th colspan="2" style="text-align:center;">Total</th>
    </tr>
    <tr>
      <th></th>
      {% for dia in dias %}
        <th style="text-align:center;">Roll</th>
        <th style="text-align:center;">Weight</th>
      {% endfor %}
      <th style="text-align:center;">Roll</th>
      <th style="text-align:center;">Weight</th>
    </tr>
  </thead>
  <tbody>
    {% for fabric_group in grouped_delivery_details %}
      {% for color_group in fabric_group.color_groups %}
        <tr>
          <td>{{ color_group.color }}</td>
          {% for dia in dias %}
            {% with found=False %}
              {% for d in color_group.dias %}
                {% if d.dia == dia %}
                  <td align="center">{{ d.roll|floatformat:0 }}</td>
                  <td align="center">{{ d.roll_wt|floatformat:3 }}</td>
                  {% with found=True %}{% endwith %}
                {% endif %}
              {% endfor %}
              {% if not found %}
                <td align="center">-</td>
                <td align="center">-</td>
              {% endif %}
            {% endwith %}
          {% endfor %}
          <td align="center"><strong>{{ color_group.total_roll|floatformat:0 }}</strong></td>
          <td align="center"><strong>{{ color_group.total_weight|floatformat:3 }}</strong></td>
        </tr>
      {% endfor %}
    {% endfor %}
  </tbody>
  <tfoot>
    <tr>
      <td align="right"><strong>Total</strong></td>   
      {% for total in dia_totals_list %}
        <td align="center"><strong>{{ total.roll|floatformat:0 }}</strong></td>
        <td align="center"><strong>{{ total.roll_wt|floatformat:2 }}</strong></td>
      {% endfor %}
      <td align="center"><strong>{{ grand_total_roll|floatformat:0 }}</strong></td>
      <td align="center"><strong>{{ grand_total_weight|floatformat:2 }}</strong></td>
    </tr>
  </tfoot>
</table> -->

      <div class="page-break">
        <table class="table table-striped table-bordered">
          <tbody>
            <tr>
              <td colspan="2" align="center"><strong>DELIVERY INFORMATION</strong></td>
            </tr>
            <tr>
              <td><strong>Party</strong></td>
              <td><strong>Remarks</strong></td>
            </tr>
            {% for item in delivery_entries %}
              <tr>
                <td>
                  <p>{{ item.party_name }}</p>
                  <p>GSTIN: {{ item.gstin }}</p>
                  <p>MOBILE: {{ item.mobile }}</p>
                </td>
                <td><p>{{ item.remarks }}</p></td>
              </tr> 
            {% endfor %}
          </tbody>
        </table>
      </div>

      <footer id="page-footer">
        <table width="100%">
          <tr>
            <td width="50%"></td>
            <td width="50%" align="right"><strong>For MIRRA GARMENTS PVT LTD</strong></td>
          </tr>
          <tr><td colspan="2"><br><br></td></tr>
          <tr>
            <td align="left"><strong>Party's Signature</strong></td>
            <td align="right"><strong>Authorized Signature</strong></td>
          </tr>
        </table>
      </footer>
    </section>
  </body>
</html>